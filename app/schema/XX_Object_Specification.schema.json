{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://schemas.cognite.ai/requirements/XX_Object_Specification.schema.json",
    "title": "XX Object Specification",
    "type": "object",
    "additionalProperties": false,
    "required": [
        "schemaVersion",
        "moduleId",
        "objectId",
        "description",
        "identifiers",
        "dataSource",
        "properties",
        "containerSpecification",
        "relationships",
        "viewConfiguration"
    ],
    "properties": {
        "schemaVersion": { "type": "integer", "minimum": 1 },
        "moduleId": { "type": "string", "pattern": "^[a-z0-9]+(?:_[a-z0-9]+)*$" },
        "objectId": { "type": "string", "pattern": "^[a-z][A-Za-z0-9]*$" },
        "metadata": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "author": { "type": "string" },
                "date": { "type": "string" },
                "version": { "type": "string" }
            }
        },
        "description": {
            "type": "object",
            "additionalProperties": false,
            "required": ["summary", "externalId"],
            "properties": {
                "summary": { "type": "string" },
                "externalId": { "type": "string" }
            }
        },
        "identifiers": {
            "type": "object",
            "additionalProperties": false,
            "required": ["viewExternalId", "containerExternalId"],
            "properties": {
                "viewExternalId": {
                    "type": "string",
                    "pattern": "^[a-z0-9:_-]+$"
                },
                "containerExternalId": {
                    "type": "string",
                    "pattern": "^[a-z0-9:_-]+$"
                }
            }
        },
        "dataSource": {
            "type": "object",
            "additionalProperties": false,
            "required": ["sourceSystem", "space", "primaryRawTable"],
            "properties": {
                "sourceSystem": { "type": "string" },
                "space": {
                    "type": "string",
                    "pattern": "^[-a-z0-9_:.]+$"
                },
                "primaryRawTable": { "type": "string" },
                "lineage": {
                    "type": "object",
                    "additionalProperties": false,
                    "properties": {
                        "inputs": {
                            "type": "array",
                            "items": { "type": "string" }
                        },
                        "outputs": {
                            "type": "array",
                            "items": { "type": "string" }
                        }
                    }
                }
            }
        },
        "properties": {
            "type": "array",
            "items": { "$ref": "#/$defs/property" }
        },
        "containerSpecification": { "$ref": "#/$defs/containerSpecification" },
        "relationships": {
            "type": "array",
            "items": { "$ref": "#/$defs/relationship" }
        },
        "viewConfiguration": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "implements": {
                    "oneOf": [
                        { "type": "string" },
                        { "type": "array", "items": { "type": "string" }, "minItems": 1 }
                    ]
                },
                "requires": {
                    "oneOf": [
                        { "type": "string" },
                        { "type": "array", "items": { "type": "string" }, "minItems": 1 }
                    ]
                },
                "implementsCore": {
                    "oneOf": [
                        { "type": "string", "enum": [
                            "CogniteAsset", "CogniteEvent", "CogniteFile", "CogniteTimeSeries", "CogniteSequence"
                        ] },
                        { "type": "array", "items": { "type": "string", "enum": [
                            "CogniteAsset", "CogniteEvent", "CogniteFile", "CogniteTimeSeries", "CogniteSequence"
                        ] }, "minItems": 1 }
                    ]
                }
            }
        },
        "timeSeries": {
            "type": "array",
            "items": { "$ref": "#/$defs/timeSeries" }
        },
        "transformationPlan": { "$ref": "#/$defs/transformationPlan" },
        "dataQuality": { "$ref": "#/$defs/dataQuality" },
        "observability": { "$ref": "#/$defs/observability" },
        "orchestration": { "$ref": "#/$defs/orchestration" }
    },
    "$defs": {
        "property": {
            "type": "object",
            "additionalProperties": false,
            "required": ["name", "nullable"],
            "oneOf": [
                { "required": ["dataType"] },
                { "required": ["listOf"] }
            ],
            "properties": {
                "name": {
                    "type": "string",
                    "pattern": "^[a-z][A-Za-z0-9]*$"
                },
                "dataType": {
                    "type": "string",
                    "enum": [
                        "text",
                        "int32",
                        "int64",
                        "float32",
                        "float64",
                        "boolean",
                        "timestamp",
                        "date",
                        "json",
                        "geojson"
                    ]
                },
                "listOf": {
                    "type": "string",
                    "enum": [
                        "text",
                        "int32",
                        "int64",
                        "float32",
                        "float64",
                        "boolean",
                        "timestamp",
                        "date",
                        "json"
                    ]
                },
                "nullable": { "type": "boolean" },
                "sourceField": { "type": "string" },
                "description": { "type": "string" },
                "transformationRule": { "type": "string" },
                "minimum": { "type": "number" },
                "maximum": { "type": "number" },
                "minLength": { "type": "integer", "minimum": 0 },
                "maxLength": { "type": "integer", "minimum": 0 },
                "pattern": { "type": "string" },
                "allowedValues": {
                    "type": "array",
                    "items": { "type": ["string", "number", "boolean"] }
                },
                "unit": { "type": "string" }
            }
        },
        "containerSpecification": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "primaryKey": { "type": "string" },
                "required": {
                    "type": "array",
                    "items": { "type": "string" }
                },
                "unique": {
                    "type": "array",
                    "items": { "type": "string" }
                },
                "indexes": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "additionalProperties": false,
                        "required": ["name", "fields"],
                        "properties": {
                            "name": { "type": "string" },
                            "fields": {
                                "type": "array",
                                "minItems": 1,
                                "items": { "type": "string" }
                            }
                        }
                    }
                }
            }
        },
        "relationship": {
            "type": "object",
            "additionalProperties": false,
            "required": ["name", "type"],
            "properties": {
                "name": { "type": "string" },
                "type": { "type": "string", "enum": ["direct", "edge"] },
                "sourceField": { "type": "string" },
                "targetType": { "type": "string" },
                "description": { "type": "string" },
                "multiplicity": { "type": "string", "enum": ["1:1", "1:N", "N:M"] },
                "label": { "type": "string" },
                "resolution": { "type": "string" },
                "edgeSpace": { "type": "string" },
                "edgeTypeExternalId": { "type": "string" }
            }
        },
        "timeSeries": {
            "type": "object",
            "additionalProperties": false,
            "required": ["name", "sourceExternalIdPattern"],
            "properties": {
                "name": { "type": "string" },
                "sourceExternalIdPattern": { "type": "string" },
                "description": { "type": "string" }
            }
        },
        "transformationPlan": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "externalId": { "type": "string" },
                "engine": { "type": "string", "enum": ["sql", "function"] },
                "source": {
                    "type": "object",
                    "additionalProperties": false,
                    "properties": {
                        "type": { "type": "string", "enum": ["raw"] },
                        "database": { "type": "string" },
                        "table": { "type": "string" }
                    }
                },
                "target": {
                    "type": "object",
                    "additionalProperties": false,
                    "properties": {
                        "containerExternalId": { "type": "string" },
                        "upsertKeys": {
                            "type": "array",
                            "items": { "type": "string" }
                        },
                        "scdType": { "type": "string", "enum": ["SCD1", "SCD2"] }
                    }
                },
                "schedule": {
                    "type": "object",
                    "additionalProperties": false,
                    "properties": {
                        "cron": { "type": "string" },
                        "timezone": { "type": "string" }
                    }
                },
                "idempotent": { "type": "boolean" },
                "backfill": {
                    "type": "object",
                    "additionalProperties": false,
                    "properties": {
                        "strategy": { "type": "string", "enum": ["full", "date_range"] },
                        "from": { "type": "string" }
                    }
                }
            }
        },
        "dataQuality": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "rules": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "additionalProperties": false,
                        "required": ["name", "type", "field"],
                        "properties": {
                            "name": { "type": "string" },
                            "type": { "type": "string", "enum": ["not_null", "range", "regex", "unique"] },
                            "field": { "type": "string" },
                            "severity": { "type": "string", "enum": ["info", "warn", "error"] },
                            "min": { "type": "number" },
                            "max": { "type": "number" },
                            "pattern": { "type": "string" }
                        }
                    }
                }
            }
        },
        "observability": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "owner": { "type": "string" },
                "sla": {
                    "type": "object",
                    "additionalProperties": false,
                    "properties": {
                        "freshnessMinutes": { "type": "integer", "minimum": 0 },
                        "maxErrorRatePct": { "type": "number", "minimum": 0 }
                    }
                }
            }
        },
        "orchestration": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "playbookExternalId": { "type": "string" },
                "tasks": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "additionalProperties": false,
                        "required": ["type"],
                        "properties": {
                            "type": { "type": "string", "enum": ["transformation", "contextualization"] },
                            "ref": { "type": "string" }
                        }
                    }
                }
            }
        }
    }
}

