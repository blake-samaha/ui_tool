# schema: https://schemas.cognite.ai/requirements/XX_Object_Specification.schema.json
schemaVersion: 1
moduleId: my_module
objectId: workOrder

metadata:
  author: Jane Doe
  date: 2025-08-08
  version: 1.0

description:
  summary: A work order raised in the maintenance system.
  externalId: work_order_master_data

identifiers:
  viewExternalId: my_module:view:work_order:v1
  containerExternalId: my_module:container:work_order:v1

dataSource:
  sourceSystem: SAP S/4HANA
  space: sp_my_project_space
  primaryRawTable: sap_zpm_workorders
  lineage:
    inputs: ["raw:raw_sap_s4hana.sap_zpm_workorders"]
    outputs: ["dm:sp_my_project_space.my_module:container:work_order:v1"]

properties:
  - name: workOrderNumber
    dataType: text
    nullable: false
    sourceField: AUFNR
    description: SAP Work Order number
  - name: description
    dataType: text
    nullable: true
    sourceField: KTEXT
  - name: createdTime
    dataType: timestamp
    nullable: false
    sourceField: ERDAT

containerSpecification:
  primaryKey: workOrderNumber
  required: [workOrderNumber]
  unique: [workOrderNumber]
  indexes:
    - name: idx_workOrder_createdTime
      fields: [createdTime]

relationships:
  - name: asset
    type: direct
    sourceField: OBJNR
    targetType: my_module:view:well:v1
    description: A work order is performed on an asset (well).
    multiplicity: 1:N
    label: performedOn
    resolution: join via externalId

viewConfiguration:
  implements: CogniteAsset v1
  requires: ParentView

timeSeries:
  - name: cost
    sourceExternalIdPattern: myco:wo:{{workOrderNumber}}:cost
    description: Total maintenance cost time series

transformationPlan:
  externalId: tr_my_module_workOrder
  engine: sql
  source:
    type: raw
    database: raw_sap_s4hana
    table: sap_zpm_workorders
  target:
    containerExternalId: my_module:container:work_order:v1
    upsertKeys: [workOrderNumber]
    scdType: SCD1
  schedule:
    cron: 0 * * * *
    timezone: UTC
  idempotent: true
  backfill:
    strategy: full
    from: 2020-01-01

dataQuality:
  rules:
    - name: not_null_workOrderNumber
      type: not_null
      field: workOrderNumber
      severity: error
    - name: range_createdTime
      type: range
      field: createdTime
      min: 946684800000
      max: 4102444800000

observability:
  owner: team-data
  sla:
    freshnessMinutes: 60
    maxErrorRatePct: 1

orchestration:
  playbookExternalId: pb_my_module_workOrder
  tasks:
    - type: transformation
      ref: ${transformation.externalId}
    - type: contextualization
      ref: ctx_my_module_workOrder


